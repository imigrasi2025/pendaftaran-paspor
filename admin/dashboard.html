<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - M-PASPOR</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        body {
            background-color: #f0f2f5;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        .navbar {
            background-color: #0056b3; /* Darker blue for a professional feel */
        }
        .container {
            max-width: 800px; /* Slightly wider container */
        }
        .card {
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            border: none;
        }
        .card-header {
            background-color: #007bff; /* Primary blue */
            color: white;
            border-top-left-radius: 12px;
            border-top-right-radius: 12px;
            padding: 20px;
            font-size: 1.5rem;
            font-weight: 600;
        }
        .alert-warning-custom {
            background-color: #fff3cd; /* Light yellow */
            border-color: #ffeeba; /* Darker yellow border */
            color: #856404; /* Dark yellow text */
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 30px;
            animation: fadeInDown 0.5s ease-out;
        }
        .alert-warning-custom .alert-heading {
            color: #856404;
            font-weight: 700;
        }
        .btn-primary {
            background-color: #007bff;
            border-color: #007bff;
            border-radius: 8px;
            padding: 10px 20px;
            font-size: 1.1rem;
            transition: all 0.3s ease;
        }
        .btn-primary:hover {
            background-color: #0056b3;
            border-color: #0056b3;
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(0, 123, 255, 0.3);
        }
        .form-label {
            font-weight: 600;
            color: #343a40;
        }
        .form-control {
            border-radius: 8px;
            padding: 10px;
        }
        @keyframes fadeInDown {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
    </style>
</head>
<body>
    <nav class="navbar navbar-dark mb-5">
        <div class="container-fluid">
            <span class="navbar-brand mb-0 h1"><i class="fas fa-tachometer-alt me-2"></i>Admin Dashboard</span>
        </div>
    </nav>

    <div class="container">
        
        <div id="user-request-alert" class="alert alert-warning-custom" role="alert">
            <h4 class="alert-heading"><i class="fas fa-exclamation-triangle me-2"></i>Pemberitahuan Penting!</h4>
            <p id="request-details"></p>
            <hr>
            <p class="mb-0" id="request-time"></p>
        </div>

        <div class="card">
            <div class="card-header">
                Formulir Pemberian Pembayaran
            </div>
            <div class="card-body p-4">
                <form id="paymentForm">
                    <div class="mb-3">
                        <label for="applicationNumberAdmin" class="form-label">No. Permohonan</label>
                        <input type="text" class="form-control" id="applicationNumberAdmin" placeholder="Masukkan nomor permohonan" required>
                    </div>
                    <div class="mb-3">
                        <label for="paymentNumber" class="form-label">No. Pembayaran</label>
                        <input type="text" class="form-control" id="paymentNumber" placeholder="Masukkan nomor pembayaran" required>
                    </div>
                    <div class="mb-3">
                        <label for="paymentName" class="form-label">Nama Pembayaran</label>
                        <input type="text" class="form-control" id="paymentName" value="Pembayaran Paspor" required>
                    </div>
                    <div class="mb-3">
                        <label for="paymentAmount" class="form-label">Nominal Pembayaran</label>
                        <input type="number" class="form-control" id="paymentAmount" value="350000" required>
                    </div>
                    <button type="submit" class="btn btn-primary w-100 mt-3"><i class="fas fa-paper-plane me-2"></i>Simpan & Berikan ke User</button>
                </form>
            </div>
        </div>
    </div>

    <script>
        const alertBox = document.getElementById('user-request-alert');
        const requestTimeEl = document.getElementById('request-time');
        const requestDetailsEl = document.getElementById('request-details');

        // Simplified location data for display purposes
        const locationDataSimple = {
            jakarta: [
                { id: 'jakarta-pusat', name: 'Kantor Imigrasi Jakarta Pusat' },
                { id: 'jakarta-selatan', name: 'Kantor Imigrasi Jakarta Selatan' },
                { id: 'jakarta-timur', name: 'Kantor Imigrasi Jakarta Timur' },
                { id: 'jakarta-barat', name: 'Kantor Imigrasi Jakarta Barat' },
                { id: 'ulp-lippo-mall-puri', name: 'ULP Lippo Mall Puri' },
                { id: 'ulp-pasar-pagi-mangga-dua', name: 'ULP Pasar Pagi Mangga Dua' },
                { id: 'immigration-lounge-pim3', name: 'Immigration Lounge PIM 3' },
                { id: 'up3-bandara-soetta', name: 'UP3 Bandara Soekarno Hatta' },
                { id: 'ulp-mall-cibubur-junction', name: 'ULP Mall Cibubur Junction' },
                { id: 'ulp-plaza-semanggi', name: 'ULP Plaza Semanggi' },
                { id: 'ulp-lippo-mall-kemang', name: 'ULP Lippo Mall Kemang' },
                { id: 'ulp-wilayah-i-jaksel', name: 'ULP Wilayah I Jakarta Selatan' }
            ],
            jabar: [
                { id: 'bandung', name: 'Kantor Imigrasi Bandung' },
                { id: 'bogor', name: 'Kantor Imigrasi Bogor' },
                { id: 'cirebon', name: 'Kantor Imigrasi Cirebon' },
                { id: 'depok', name: 'Kantor Imigrasi Depok' },
                { id: 'karawang', name: 'Kantor Imigrasi Karawang' },
                { id: 'sukabumi', name: 'Kantor Imigrasi Sukabumi' },
                { id: 'tasikmalaya', name: 'Kantor Imigrasi Tasikmalaya' },
                { id: 'bekasi', name: 'Kantor Imigrasi Bekasi' },
                { id: 'cianjur', name: 'Kantor Imigrasi Cianjur' }
            ],
            jateng: [
                { id: 'semarang', name: 'Kantor Imigrasi Semarang' },
                { id: 'surakarta', name: 'Kantor Imigrasi Surakarta (Solo)' },
                { id: 'pemalang', name: 'Kantor Imigrasi Pemalang' },
                { id: 'pati', name: 'Kantor Imigrasi Pati' },
                { id: 'cilacap', name: 'Kantor Imigrasi Cilacap' },
                { id: 'wonosobo', name: 'Kantor Imigrasi Wonosobo' }
            ],
            jatim: [
                { id: 'malang', name: 'Kantor Imigrasi Malang' },
                { id: 'surabaya-khusus', name: 'Kantor Imigrasi Surabaya' },
                { id: 'tanjung-perak', name: 'Kantor Imigrasi Tanjung Perak' },
                { id: 'blitar', name: 'Kantor Imigrasi Blitar' },
                { id: 'jember', name: 'Kantor Imigrasi Jember' },
                { id: 'madiun', name: 'Kantor Imigrasi Madiun' },
                { id: 'kediri', name: 'Kantor Imigrasi Kediri' },
                { id: 'pamekasan', name: 'Kantor Imigrasi Pamekasan' },
                { id: 'ponorogo', name: 'Kantor Imigrasi Ponorogo' }
            ],
            sumatera: [
                { id: 'medan', name: 'Kantor Imigrasi Medan' },
                { id: 'belawan', name: 'Kantor Imigrasi Belawan' },
                { id: 'pematang-siantar', name: 'Kantor Imigrasi Pematang Siantar' },
                { id: 'palembang', name: 'Kantor Imigrasi Palembang' },
                { id: 'muaraenim', name: 'Kantor Imigrasi Muaraenim' },
                { id: 'padang', name: 'Kantor Imigrasi Padang' },
                { id: 'bengkulu', name: 'Kantor Imigrasi Bengkulu' }
            ],
            batam: [
                { id: 'batam-pusat', name: 'Kantor Imigrasi Batam' }
            ],
            bali_ntb: [
                { id: 'mataram', name: 'Kantor Imigrasi Mataram' }
            ]
        };

        function getLocationNameById(id) {
            for (const region in locationDataSimple) {
                const found = locationDataSimple[region].find(loc => loc.id === id);
                if (found) return found.name;
            }
            return id; // Return ID if not found
        }

        function getPassportTypeName(type) {
            if (type === '5tahun') return 'e-Paspor 5 Tahun';
            if (type === '10tahun') return 'e-Paspor 10 Tahun';
            return type; // Return type if not recognized
        }

        function checkForPaymentRequest() {
            const request = localStorage.getItem('paymentRequest');
            if (request) {
                const requestData = JSON.parse(request);
                
                const userName = requestData.userName || 'Pengguna Tidak Dikenal';
                const passportType = getPassportTypeName(requestData.passportType);
                const locationName = getLocationNameById(requestData.selectedLocationId);
                const applicationId = requestData.applicationId || 'Tidak Tersedia'; // Get application ID

                requestDetailsEl.innerHTML = `
                    <strong>No. Permohonan:</strong> ${applicationId}<br>
                    <strong>Nama Pengguna:</strong> ${userName}<br>
                    <strong>Jenis Paspor:</strong> ${passportType}<br>
                    <strong>Lokasi Pilihan:</strong> ${locationName}<br>
                `;
                requestTimeEl.textContent = `Permintaan dibuat pada: ${new Date(requestData.requestedAt).toLocaleString()}`;
                alertBox.style.display = 'block';

                // Pre-fill the application number field for the admin
                document.getElementById('applicationNumberAdmin').value = applicationId;

            } else {
                alertBox.style.display = 'none';
                // Clear the application number field when no request is active
                document.getElementById('applicationNumberAdmin').value = '';
            }
        }

        document.getElementById('paymentForm').addEventListener('submit', function(event) {
            event.preventDefault();
            
            const paymentDetails = {
                applicationNumber: document.getElementById('applicationNumberAdmin').value, // New: Application Number
                number: document.getElementById('paymentNumber').value, // Existing: Payment Number
                name: document.getElementById('paymentName').value,
                amount: document.getElementById('paymentAmount').value,
                date: new Date().toLocaleString()
            };

            localStorage.setItem('latestPaymentInfo', JSON.stringify(paymentDetails));
            
            let history = JSON.parse(localStorage.getItem('paymentHistory')) || [];
            history.unshift(paymentDetails); 
            localStorage.setItem('paymentHistory', JSON.stringify(history));

            localStorage.removeItem('paymentRequest');

            alert('Detail pembayaran telah disimpan dan akan ditampilkan di halaman pembayaran pengguna.');
            
            checkForPaymentRequest();
        });

        document.addEventListener('DOMContentLoaded', () => {
            checkForPaymentRequest(); 
            setInterval(checkForPaymentRequest, 3000); 
        });
    </script>
</body>
</html>
